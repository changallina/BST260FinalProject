---
title: "BST260FinalProject"
output: html_document
---


```{r}
library(tidyverse)
library(ggplot2)
library(rvest)
library(maps)
```

```{r}
# import datasets
install.packages("gsheet")
library(gsheet)
url20 <- "https://docs.google.com/spreadsheets/d/1vkHkvnZFhtekjkYbF-y7uVo4oE36ROaqJx4lxVIkdq4/edit?usp=sharing"
dat20 <- gsheet2tbl(url20, sheetid = NULL)

#shiny
dat2_1 <- "https://docs.google.com/spreadsheets/d/1bAzkkXU3W7LALAzP2cnaahbf-s52kr8GvjJ3pIaK9Cs/edit?usp=sharing"
whr2_1 <- gsheet2tbl(dat2_1, sheetid = NULL)
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
world_map = map_data("world")

#dat20[is.na(match(dat20$`Country name`, world_map$region)), ]

dat20 <- dat20 %>%
  mutate(new_names = recode(`Country name`,
    "United Kingdom" = "UK",
    "United States" = "USA",
    "Taiwan Province of China" = "Taiwan",
    "Trinidad and Tobago" = "Trinidad",
    "North Cyprus" = "Cyprus",
    "Hong Kong S.A.R. of China" = "Hong Kong",
    "Palestinian Territories" = "Palestine",
    "Congo (Brazzaville)" = "Democratic Republic of the Congo"
  )
  )

world_map <- within(world_map, region[region == "China" & subregion == "Hong Kong"] <- "Hong Kong")

world_map <- world_map %>%
  rename("Country" = region)

dat20 <- dat20 %>%
  rename("Country" = new_names)

combined_countries <- full_join(dat20, world_map)


combined_countries <- combined_countries %>% mutate(manual_fill = cut(`Ladder score`, 
                         breaks = c(-Inf, 1, 2, 3, 4, 5, 6, 7, Inf),
                         labels = c("<1", "1-2", "2-3", "3-4", 
                                    "4-5", "5-6", "6-7", ">7"), 
                         right = TRUE))
```


```{r}
library(sf)
library(ggrepel)
library(ggspatial)

#happiest countries in each continent (do we want to label happiest + least happiest country in each continent?)
topcities <- data.frame(Country = c("Taiwan", "Australia", "Mauritius", "Chile", "Canada", "Finland"), 
    lat = c(23.6978, -43.23242, -20.48486, -33.447487, 56.1394, 60.04068), 
    lng = c(120.9605, 147.3488, 57.65127, -70.673676, -106.3468, 20.61133))

(topcities <- st_as_sf(topcities, coords = c("lng", "lat"), remove = FALSE, 
    crs = 4326, agr = "constant"))

ggplot() +
  geom_polygon(combined_countries, mapping = aes(x = long, y = lat, group = group, fill = manual_fill)) +
  geom_text_repel(data = topcities, aes(x = lng, y = lat, label = Country), 
                  size = 3,
                  color = "orange",
                  fontface = "bold",
                  nudge_x = c(25, -1.5, 15, -13, -40, -16),
                  nudge_y = c(-5, -15, 10, 3, -7, 13),
                  min.segment.length = unit(0, "lines")) +
  #need to play around with nudge to align properly. also can't figure out how to draw a line from label to the dot
  geom_sf(data = topcities, alpha = 0.5, size = 0.5, color = "blue") +
  ggtitle("Happiness Levels Across the World in 2019") +
  scale_fill_manual(name = "Cantrill Ladder Score", 
                     values = c("lightcyan", 
                                "lightskyblue2",
                                "dodgerblue3", 
                                "dodgerblue4",
                                "darkgoldenrod2",
                                "gold1")) +
  theme(legend.position = "bottom") +
  guides(shape = guide_legend(override.aes = list(size = 5))) +
  theme(panel.grid.major = element_blank(), 
        panel.background = element_blank(),
        axis.title = element_blank(), 
        axis.text = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.y = element_blank())
```

## Including Plots

You can also embed plots, for example:

```{r}
whr2_1$year <- as.Date(whr2_1$year)
whr2_1 %>% filter (`Country name` == "Afghanistan") %>% 
  ggplot(aes(x = year, y = `Life Ladder`, color = `Country name`)) +
    geom_line() +
    scale_x_continuous(breaks = c(2007, 2020))
```


